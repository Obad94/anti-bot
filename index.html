<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SecureTickets Pro - Taylor Swift | The Eras Tour</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: #0a0a0a;
            color: #ffffff;
            line-height: 1.6;
            overflow-x: hidden;
        }

        .navbar {
            background: rgba(0, 0, 0, 0.95);
            backdrop-filter: blur(20px);
            padding: 1rem 2rem;
            position: fixed;
            top: 0;
            width: 100%;
            z-index: 1000;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .nav-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 24px;
            font-weight: 800;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .security-badge {
            display: flex;
            align-items: center;
            gap: 8px;
            background: rgba(76, 175, 80, 0.2);
            padding: 8px 16px;
            border-radius: 20px;
            border: 1px solid #4CAF50;
        }

        .security-badge .shield {
            width: 16px;
            height: 16px;
            background: #4CAF50;
            border-radius: 50%;
        }

        .main-content {
            margin-top: 80px;
            max-width: 1400px;
            margin-left: auto;
            margin-right: auto;
            padding: 2rem;
        }

        .event-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 20px;
            padding: 3rem;
            margin-bottom: 2rem;
            position: relative;
            overflow: hidden;
        }

        .event-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grain" width="100" height="100" patternUnits="userSpaceOnUse"><circle cx="25" cy="25" r="1" fill="rgba(255,255,255,0.05)"/><circle cx="75" cy="75" r="1" fill="rgba(255,255,255,0.05)"/><circle cx="50" cy="10" r="0.5" fill="rgba(255,255,255,0.03)"/></pattern></defs><rect width="100" height="100" fill="url(%23grain)"/></svg>');
            opacity: 0.3;
        }

        .event-info {
            position: relative;
            z-index: 2;
        }

        .event-title {
            font-size: 3rem;
            font-weight: 900;
            margin-bottom: 1rem;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .event-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-top: 2rem;
        }

        .detail-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 1rem;
            border-radius: 10px;
            backdrop-filter: blur(10px);
        }

        .detail-label {
            font-size: 0.9rem;
            opacity: 0.8;
            margin-bottom: 0.5rem;
        }

        .detail-value {
            font-size: 1.1rem;
            font-weight: 600;
        }

        .warning {
            background: rgba(255, 193, 7, 0.1);
            border: 2px solid #ffc107;
            border-radius: 15px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            text-align: center;
        }

        .warning h3 {
            color: #ffc107;
            margin-bottom: 1rem;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin: 1.5rem 0;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.08);
            border-radius: 12px;
            padding: 1.5rem;
            border: 2px solid rgba(255, 255, 255, 0.1);
            text-align: center;
        }

        .stat-title {
            font-size: 0.9rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: #4CAF50;
        }

        .stat-value {
            font-size: 1.8rem;
            font-weight: 900;
            margin-bottom: 0.25rem;
            color: #ffffff;
        }

        .stat-label {
            color: rgba(255, 255, 255, 0.6);
            font-size: 0.8rem;
        }

        .difficulty-indicator {
            background: rgba(255, 152, 0, 0.1);
            border: 2px solid #ff9800;
            padding: 2rem;
            border-radius: 15px;
            margin: 2rem 0;
            text-align: center;
        }

        .difficulty-text {
            color: #ff9800;
            font-weight: 600;
            font-size: 1.1rem;
        }

        .difficulty-level {
            font-size: 3rem;
            font-weight: 900;
            color: #ff9800;
            margin: 0.5rem 0;
        }

        .cpu-warning {
            background: rgba(255, 87, 51, 0.15);
            border: 2px solid #ff5733;
            border-radius: 10px;
            padding: 1rem;
            margin: 1rem 0;
            text-align: center;
            display: none;
            animation: pulse 1.5s infinite;
        }

        .cpu-warning.show {
            display: block;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .ticket-selection {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 2rem;
            margin: 2rem 0;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .section-title {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 1.5rem;
            color: #ffffff;
        }

        .ticket-options {
            display: grid;
            gap: 1rem;
        }

        .ticket-option {
            background: rgba(255, 255, 255, 0.08);
            border: 2px solid transparent;
            border-radius: 12px;
            padding: 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .ticket-option:hover {
            background: rgba(255, 255, 255, 0.12);
            border-color: rgba(102, 126, 234, 0.5);
            transform: translateY(-2px);
        }

        .ticket-option.selected {
            background: rgba(102, 126, 234, 0.2);
            border-color: #667eea;
        }

        .ticket-info h4 {
            color: #ffffff;
            font-size: 1.2rem;
            margin-bottom: 0.5rem;
        }

        .ticket-description {
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.9rem;
        }

        .ticket-price {
            font-size: 1.5rem;
            font-weight: 700;
            color: #4CAF50;
        }

        .quantity-selector {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-top: 1rem;
        }

        .quantity-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: #ffffff;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            transition: all 0.2s ease;
        }

        .quantity-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .quantity-display {
            font-size: 1.2rem;
            font-weight: 600;
            color: #ffffff;
            min-width: 40px;
            text-align: center;
        }

        .total-display {
            background: rgba(76, 175, 80, 0.1);
            border: 2px solid #4CAF50;
            border-radius: 15px;
            padding: 1.5rem;
            margin: 2rem 0;
            text-align: center;
        }

        .total-amount {
            font-size: 2rem;
            font-weight: 800;
            color: #4CAF50;
        }

        .security-challenge {
            background: linear-gradient(135deg, rgba(255, 87, 51, 0.1), rgba(255, 87, 51, 0.05));
            border: 2px solid #ff5733;
            border-radius: 15px;
            padding: 2rem;
            margin: 2rem 0;
            text-align: center;
        }

        .security-challenge.active {
            animation: securityPulse 2s infinite;
        }

        @keyframes securityPulse {
            0%, 100% { border-color: #ff5733; }
            50% { border-color: #ff8c42; }
        }

        .challenge-icon {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #ff5733, #ff8c42);
            border-radius: 50%;
            margin: 0 auto 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }

        .challenge-title {
            font-size: 1.3rem;
            font-weight: 700;
            color: #ffffff;
            margin-bottom: 0.5rem;
        }

        .challenge-description {
            color: rgba(255, 255, 255, 0.8);
            margin-bottom: 1.5rem;
        }

        .progress-container {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            height: 12px;
            overflow: hidden;
            margin: 1rem 0;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #45a049);
            width: 0%;
            transition: width 0.3s ease;
            border-radius: 20px;
        }

        .progress-section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 2rem;
            margin: 2rem 0;
        }

        .progress-item {
            margin: 1rem 0;
        }

        .progress-label {
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: #ffffff;
        }

        .progress-bar-full {
            width: 100%;
            height: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #45a049);
            width: 0%;
            transition: width 0.3s ease;
            border-radius: 10px;
        }

        .action-buttons {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin-top: 2rem;
            flex-wrap: wrap;
        }

        .btn {
            padding: 1rem 2rem;
            border: none;
            border-radius: 50px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #ffffff;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .btn-bulk {
            background: linear-gradient(135deg, #ff9800, #f57c00);
            color: white;
        }

        .btn-reset {
            background: linear-gradient(135deg, #607d8b, #455a64);
            color: white;
        }

        .btn-bulk:hover, .btn-reset:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }

        .log-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin: 2rem 0;
        }

        .log-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 1.5rem;
            border: 2px solid rgba(255, 255, 255, 0.1);
        }

        .log-title {
            font-size: 1.3rem;
            font-weight: 700;
            margin-bottom: 1rem;
            color: #4CAF50;
        }

        .log-content {
            background: rgba(0, 0, 0, 0.4);
            border-radius: 10px;
            padding: 1rem;
            font-family: 'Courier New', monospace;
            font-size: 0.85rem;
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .log-entry {
            margin: 0.25rem 0;
            padding: 0.25rem 0;
        }

        .log-success { color: #4CAF50; }
        .log-working { color: #ff9800; }
        .log-info { color: #2196F3; }
        .log-warning { color: #ff9800; }
        .log-error { color: #ff5733; }

        .toast {
            position: fixed;
            top: 100px;
            right: 20px;
            background: rgba(76, 175, 80, 0.95);
            color: white;
            padding: 1rem 1.5rem;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            transform: translateX(100%);
            transition: transform 0.3s ease;
            z-index: 1001;
        }

        .toast.show {
            transform: translateX(0);
        }

        .toast.error {
            background: rgba(255, 87, 51, 0.95);
        }

        @media (max-width: 768px) {
            .main-content {
                padding: 1rem;
            }
            
            .event-title {
                font-size: 2rem;
            }
            
            .event-details {
                grid-template-columns: 1fr;
            }
            
            .action-buttons {
                flex-direction: column;
            }

            .log-section {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="nav-content">
            <div class="logo">SecureTickets Pro</div>
            <div class="security-badge">
                <div class="shield"></div>
                <span>Adaptive PoW Defense Active</span>
            </div>
        </div>
    </nav>

    <main class="main-content">
        <div class="event-header">
            <div class="event-info">
                <h1 class="event-title">Taylor Swift | The Eras Tour</h1>
                <div class="event-details">
                    <div class="detail-item">
                        <div class="detail-label">📅 Date</div>
                        <div class="detail-value">Saturday, August 12, 2025</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">🕐 Time</div>
                        <div class="detail-value">7:30 PM</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">📍 Venue</div>
                        <div class="detail-value">MetLife Stadium</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">🎫 Total Purchases</div>
                        <div class="detail-value" id="ticketsRemaining">0</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="warning">
            <h3>📊 Open Task Manager/Activity Monitor NOW!</h3>
            <p>Watch your CPU usage spike as you run the proof-of-work computations. Each purchase makes the next one exponentially harder for everyone.</p>
        </div>

        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-title">📋 Total Purchases</div>
                <div class="stat-value" id="totalPurchases">0</div>
                <div class="stat-label">All users combined</div>
            </div>

            <div class="stat-card">
                <div class="stat-title">⚡ Total Hash Operations</div>
                <div class="stat-value" id="totalHashes">0</div>
                <div class="stat-label">SHA-256 computations</div>
            </div>

            <div class="stat-card">
                <div class="stat-title">⏱️ Total CPU Time</div>
                <div class="stat-value" id="totalTime">0s</div>
                <div class="stat-label">Computation time used</div>
            </div>

            <div class="stat-card">
                <div class="stat-title">💰 Est. Electricity Cost</div>
                <div class="stat-value" id="electricityCost">$0.000</div>
                <div class="stat-label">Based on $0.12/hour</div>
            </div>
        </div>

        <div class="difficulty-indicator">
            <div class="difficulty-text">🛡️ Current Security Level</div>
            <div class="difficulty-level" id="currentDifficulty">4</div>
            <div style="color: rgba(255,255,255,0.8);">
                Next purchase requires <span id="expectedTime">~2 seconds</span> of computation
            </div>
        </div>

        <div class="cpu-warning" id="cpuWarning">
            ⚠️ HIGH CPU USAGE DETECTED! Your computer is working hard to solve proof-of-work challenges.
        </div>

        <div class="ticket-selection">
            <h2 class="section-title">Select Your Tickets</h2>
            <div class="ticket-options">
                <div class="ticket-option" onclick="selectTicket('vip', 599)">
                    <div class="ticket-info">
                        <h4>VIP Experience Package</h4>
                        <p class="ticket-description">Front row seats, meet & greet, exclusive merchandise</p>
                    </div>
                    <div class="ticket-price">$599</div>
                </div>
                
                <div class="ticket-option" onclick="selectTicket('premium', 299)">
                    <div class="ticket-info">
                        <h4>Premium Seating</h4>
                        <p class="ticket-description">Lower bowl, excellent view, early entry</p>
                    </div>
                    <div class="ticket-price">$299</div>
                </div>
                
                <div class="ticket-option selected" onclick="selectTicket('standard', 149)">
                    <div class="ticket-info">
                        <h4>Standard Admission</h4>
                        <p class="ticket-description">Upper level seating, great atmosphere</p>
                    </div>
                    <div class="ticket-price">$149</div>
                </div>
            </div>

            <div class="quantity-selector">
                <span style="color: #ffffff; font-weight: 600;">Quantity:</span>
                <button class="quantity-btn" onclick="changeQuantity(-1)">−</button>
                <span class="quantity-display" id="quantity">1</span>
                <button class="quantity-btn" onclick="changeQuantity(1)">+</button>
                <span style="color: rgba(255,255,255,0.6); margin-left: 1rem;">(No limit - buy as many as you want!)</span>
            </div>
        </div>

        <div class="total-display">
            <div>Total: <span class="total-amount" id="totalAmount">$149.00</span></div>
            <div style="color: rgba(255,255,255,0.7); margin-top: 0.5rem;" id="totalDescription">1 × Standard Admission ($149 each)</div>
        </div>

        <div class="security-challenge" id="securityChallenge">
            <div class="challenge-icon">🛡️</div>
            <h3 class="challenge-title">Adaptive Security Verification</h3>
            <p class="challenge-description">Our system automatically adjusts security difficulty based on demand and threat level. Higher global purchases = exponentially higher security requirements for everyone.</p>
            
            <div class="progress-container">
                <div class="progress-bar" id="progressBar"></div>
            </div>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-title">Time</div>
                    <div class="stat-value" id="timeElapsed">0.0s</div>
                    <div class="stat-label">Elapsed</div>
                </div>
                <div class="stat-card">
                    <div class="stat-title">Hash Rate</div>
                    <div class="stat-value" id="hashRate">0</div>
                    <div class="stat-label">H/s</div>
                </div>
                <div class="stat-card">
                    <div class="stat-title">Attempts</div>
                    <div class="stat-value" id="attempts">0</div>
                    <div class="stat-label">Hashes</div>
                </div>
                <div class="stat-card">
                    <div class="stat-title">Difficulty</div>
                    <div class="stat-value" id="difficulty">4</div>
                    <div class="stat-label">Level</div>
                </div>
            </div>

            <div class="action-buttons">
                <button class="btn btn-primary" onclick="startVerification()" id="verifyBtn">
                    🔒 Purchase Tickets
                </button>
                
                <button class="btn btn-bulk" onclick="bulkPurchase(3)">
                    📦 Buy 3 Batches
                </button>
                
                <button class="btn btn-bulk" onclick="bulkPurchase(5)">
                    🔥 Buy 5 Batches (High CPU!)
                </button>
                
                <button class="btn btn-reset" onclick="resetSystem()">
                    🔄 Reset System
                </button>
            </div>
        </div>

        <div class="progress-section">
            <h3 style="margin-bottom: 1rem; color: #ffffff;">🔄 Current Operations</h3>
            <div class="progress-item">
                <div class="progress-label">Active Proof-of-Work Computations</div>
                <div class="progress-bar-full">
                    <div class="progress-fill" id="overallProgress"></div>
                </div>
            </div>
        </div>

        <div class="log-section">
            <div class="log-card">
                <div class="log-title">📊 System Activity Log</div>
                <div class="log-content" id="systemLog"></div>
            </div>

            <div class="log-card">
                <div class="log-title">⚡ Performance Metrics</div>
                <div class="log-content" id="performanceLog"></div>
            </div>
        </div>
    </main>

    <div class="toast" id="toast"></div>

    <script>
        // Global state
        let selectedTicketType = 'standard';
        let selectedPrice = 149;
        let quantity = 1;
        let totalPurchases = 0;
        let systemDifficulty = 4;
        let totalHashes = 0;
        let totalCpuTime = 0;
        let activeWorkers = [];
        let isVerifying = false;

        // Logging functions
        function logSystem(message, type = 'info') {
            const log = document.getElementById('systemLog');
            const timestamp = new Date().toLocaleTimeString();
            const entry = document.createElement('div');
            entry.className = `log-entry log-${type}`;
            entry.textContent = `[${timestamp}] ${message}`;
            log.appendChild(entry);
            log.scrollTop = log.scrollHeight;

            // Keep only last 20 entries
            while (log.children.length > 20) {
                log.removeChild(log.firstChild);
            }
        }

        function logPerformance(message, type = 'info') {
            const log = document.getElementById('performanceLog');
            const timestamp = new Date().toLocaleTimeString();
            const entry = document.createElement('div');
            entry.className = `log-entry log-${type}`;
            entry.textContent = `[${timestamp}] ${message}`;
            log.appendChild(entry);
            log.scrollTop = log.scrollHeight;

            // Keep only last 20 entries
            while (log.children.length > 20) {
                log.removeChild(log.firstChild);
            }
        }

        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = `toast ${type}`;
            toast.classList.add('show');
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        function selectTicket(type, price) {
            document.querySelectorAll('.ticket-option').forEach(option => {
                option.classList.remove('selected');
            });
            event.target.closest('.ticket-option').classList.add('selected');
            
            selectedTicketType = type;
            selectedPrice = price;
            updateTotal();
            
            logSystem(`Ticket selected: ${type.toUpperCase()} - $${price}`, 'info');
        }

        function changeQuantity(delta) {
            const newQuantity = quantity + delta;
            if (newQuantity >= 1) { // Removed upper limit
                quantity = newQuantity;
                document.getElementById('quantity').textContent = quantity;
                updateTotal();
                logSystem(`Quantity changed to ${quantity}`, 'info');
            }
        }

        function updateTotal() {
            const total = selectedPrice * quantity;
            document.getElementById('totalAmount').textContent = `$${total.toFixed(2)}`;
            
            const typeNames = {
                'vip': 'VIP Experience Package',
                'premium': 'Premium Seating', 
                'standard': 'Standard Admission'
            };
            
            document.getElementById('totalDescription').textContent = 
                `${quantity} × ${typeNames[selectedTicketType]} ($${selectedPrice} each)`;
        }

        function updateDifficulty() {
            systemDifficulty = Math.min(4 + Math.floor(totalPurchases * 0.8), 18); // Increased max difficulty
            document.getElementById('currentDifficulty').textContent = systemDifficulty;
            document.getElementById('difficulty').textContent = systemDifficulty;
            document.getElementById('ticketsRemaining').textContent = totalPurchases;
            
            const avgHashes = Math.pow(2, systemDifficulty - 1);
            const expectedSeconds = avgHashes / 30000; // Conservative hash rate
            
            let timeText;
            if (expectedSeconds < 60) {
                timeText = `~${expectedSeconds.toFixed(0)} seconds`;
            } else if (expectedSeconds < 3600) {
                timeText = `~${(expectedSeconds / 60).toFixed(1)} minutes`;
            } else if (expectedSeconds < 86400) {
                timeText = `~${(expectedSeconds / 3600).toFixed(1)} hours`;
            } else {
                timeText = `~${(expectedSeconds / 86400).toFixed(1)} days`;
            }
            
            document.getElementById('expectedTime').textContent = timeText;
            
            // Show CPU warning for high difficulties
            const warning = document.getElementById('cpuWarning');
            if (systemDifficulty >= 7) {
                warning.classList.add('show');
            } else {
                warning.classList.remove('show');
            }
        }

        function updateStats() {
            document.getElementById('totalPurchases').textContent = totalPurchases;
            document.getElementById('totalHashes').textContent = totalHashes.toLocaleString();
            document.getElementById('totalTime').textContent = totalCpuTime.toFixed(1) + 's';
            
            const electricityCost = (totalCpuTime / 3600) * 0.12; // $0.12/hour
            document.getElementById('electricityCost').textContent = '$' + electricityCost.toFixed(4);
        }

        function createPoWWorker(difficulty, nonce) {
            const workerCode = `
                let running = true;
                let hashCount = 0;
                
                self.onmessage = function(e) {
                    if (e.data.action === 'stop') {
                        running = false;
                        return;
                    }
                    
                    const { nonce, difficulty } = e.data;
                    const target = '0'.repeat(difficulty);
                    let counter = 0;
                    const startTime = Date.now();
                    
                    const solve = async () => {
                        while (running) {
                            for (let i = 0; i < 2000 && running; i++) {
                                counter++;
                                hashCount++;
                                const input = nonce + counter.toString();
                                
                                const hashBuffer = await crypto.subtle.digest('SHA-256', 
                                    new TextEncoder().encode(input));
                                const hashHex = Array.from(new Uint8Array(hashBuffer))
                                    .map(b => b.toString(16).padStart(2, '0')).join('');
                                
                                if (hashHex.startsWith(target)) {
                                    const endTime = Date.now();
                                    const duration = (endTime - startTime) / 1000;
                                    self.postMessage({ 
                                        type: 'success', 
                                        counter, 
                                        hash: hashHex,
                                        hashes: hashCount,
                                        duration
                                    });
                                    return;
                                }
                            }
                            
                            const currentTime = Date.now();
                            const duration = (currentTime - startTime) / 1000;
                            self.postMessage({ 
                                type: 'progress', 
                                hashes: hashCount,
                                duration,
                                hashRate: Math.round(hashCount / duration)
                            });
                            
                            await new Promise(resolve => setTimeout(resolve, 1));
                        }
                    };
                    
                    solve();
                };
            `;

            return new Worker(URL.createObjectURL(new Blob([workerCode], { type: 'application/javascript' })));
        }

        function startVerification() {
            if (isVerifying) return;
            
            logSystem(`🎫 Purchase initiated: ${quantity}x ${selectedTicketType.toUpperCase()}`, 'info');
            makePurchase();
        }

        function makePurchase() {
            if (isVerifying) return;

            isVerifying = true;
            const currentDifficulty = systemDifficulty;
            const purchaseNumber = totalPurchases + 1;
            
            const securityChallenge = document.getElementById('securityChallenge');
            securityChallenge.classList.add('active');
            
            document.getElementById('verifyBtn').disabled = true;
            document.getElementById('verifyBtn').innerHTML = '🔄 Processing Purchase...';
            
            logSystem(`🛡️ Security verification started - Difficulty: ${currentDifficulty}`, 'warning');
            logPerformance(`Expected ~${Math.pow(2, currentDifficulty-4).toFixed(0)}x base computation time`, 'info');
            
            totalPurchases++;
            updateDifficulty();
            updateStats();
            
            const nonce = Math.random().toString(36).substring(2, 15);
            const worker = createPoWWorker(currentDifficulty, nonce);
            activeWorkers.push(worker);
            
            const startTime = Date.now();
            worker.postMessage({ nonce, difficulty: currentDifficulty });
            
            worker.onmessage = function(e) {
                if (e.data.type === 'success') {
                    const duration = e.data.duration;
                    const hashes = e.data.hashes;
                    
                    totalHashes += hashes;
                    totalCpuTime += duration;
                    
                    isVerifying = false;
                    securityChallenge.classList.remove('active');
                    
                    document.getElementById('progressBar').style.width = '100%';
                    document.getElementById('overallProgress').style.width = '100%';
                    document.getElementById('verifyBtn').innerHTML = '✅ Purchase Complete!';
                    document.getElementById('verifyBtn').style.background = 'linear-gradient(135deg, #4CAF50, #45a049)';
                    
                    const costMultiplier = Math.pow(2, currentDifficulty - 4);
                    const electricityCost = (duration / 3600) * 0.12;
                    
                    logSystem(`✅ Purchase #${purchaseNumber} completed successfully!`, 'success');
                    logPerformance(`${hashes.toLocaleString()} hashes in ${duration.toFixed(1)}s`, 'success');
                    logPerformance(`Hash rate: ${Math.round(hashes/duration).toLocaleString()} H/s`, 'working');
                    logPerformance(`Cost: $${electricityCost.toFixed(4)} (${costMultiplier.toFixed(1)}x base)`, 'info');
                    
                    showToast(`${quantity} tickets purchased successfully! Confirmation sent to email.`, 'success');
                    
                    updateStats();
                    
                    // Reset for next purchase
                    setTimeout(() => {
                        document.getElementById('verifyBtn').innerHTML = '🔒 Purchase Tickets';
                        document.getElementById('verifyBtn').style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
                        document.getElementById('verifyBtn').disabled = false;
                        document.getElementById('progressBar').style.width = '0%';
                        document.getElementById('overallProgress').style.width = '0%';
                    }, 3000);
                    
                    worker.terminate();
                    activeWorkers = activeWorkers.filter(w => w !== worker);
                    
                } else if (e.data.type === 'progress') {
                    const elapsed = (Date.now() - startTime) / 1000;
                    document.getElementById('timeElapsed').textContent = elapsed.toFixed(1) + 's';
                    document.getElementById('attempts').textContent = e.data.hashes.toLocaleString();
                    document.getElementById('hashRate').textContent = e.data.hashRate.toLocaleString();
                    
                    const expectedHashes = Math.pow(2, currentDifficulty - 1);
                    const progress = Math.min((e.data.hashes / expectedHashes) * 100, 95);
                    document.getElementById('progressBar').style.width = progress + '%';
                    document.getElementById('overallProgress').style.width = progress + '%';
                    
                    logPerformance(`Computing... ${e.data.hashes.toLocaleString()} hashes (${e.data.hashRate.toLocaleString()} H/s)`, 'working');
                }
            };
        }

        // Bulk purchase functions
        function bulkPurchase(count) {
            logSystem(`🔥 Starting bulk purchase of ${count} batches`, 'info');
            logSystem(`Watch difficulty escalate with each purchase!`, 'warning');
            
            for (let i = 0; i < count; i++) {
                setTimeout(() => {
                    makePurchase();
                }, i * 1000);
            }
        }

        // Reset the system
        function resetSystem() {
            logSystem('🔄 Resetting system to baseline...', 'info');
            logPerformance('All operations stopped', 'info');
            
            // Stop all workers
            activeWorkers.forEach(worker => {
                worker.postMessage({ action: 'stop' });
                worker.terminate();
            });
            activeWorkers = [];
            
            // Reset state
            totalPurchases = 0;
            systemDifficulty = 4;
            totalHashes = 0;
            totalCpuTime = 0;
            
            // Reset displays
            document.getElementById('progressBar').style.width = '0%';
            document.getElementById('overallProgress').style.width = '0%';
            document.getElementById('verifyBtn').innerHTML = '🔒 Purchase Tickets';
            document.getElementById('verifyBtn').disabled = false;
            document.getElementById('verifyBtn').style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
            isVerifying = false;
            document.getElementById('securityChallenge').classList.remove('active');
            
            updateDifficulty();
            updateStats();
            
            logSystem('✅ System reset complete', 'success');
            showToast('System reset to baseline difficulty', 'success');
        }

        // Initialize
        window.addEventListener('load', () => {
            updateDifficulty();
            updateTotal();
            updateStats();
            logSystem('🛡️ SecureTickets Pro initialized with adaptive defense', 'success');
            logSystem('🎯 Anti-bot protection: ACTIVE', 'success');
            logSystem('📊 Dynamic difficulty scaling enabled', 'info');
            logPerformance('Ready to demonstrate exponential scaling', 'info');
        });

        // Simulate some background activity
        setInterval(() => {
            if (!isVerifying && activeWorkers.length === 0) {
                const activities = [
                    'System monitoring: All services operational',
                    'Security scan complete: No threats detected',
                    'Adaptive difficulty: Responding to demand',
                    'Performance optimal: Ready for purchases',
                    'Defense systems: Standing by for next purchase'
                ];
                
                const randomActivity = activities[Math.floor(Math.random() * activities.length)];
                logSystem(randomActivity, 'info');
            }
        }, 15000);

        // Cleanup on page unload
        window.addEventListener('beforeunload', () => {
            activeWorkers.forEach(worker => {
                worker.postMessage({ action: 'stop' });
                worker.terminate();
            });
        });
    </script>
</body>
</html>